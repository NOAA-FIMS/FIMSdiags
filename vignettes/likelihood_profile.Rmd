---
title: "Running a likelihood profile on a FIMS model"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Running a likelihood profile on a FIMS model}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.width = 9,
  fig.height = 7,
  out.width = "100%"
)

```

```{r setup}
library(FIMSdiags)
library(FIMS)
#devtools::load_all()
packageVersion("FIMS")

clear()
```

## Set up FIMS model  
Following the minimal demo vignette, we will set up a FIMS model and run it.  

```{r run_fims_model}

# Load sample data
data("data1")
# Prepare data for FIMS model
data_4_model <- FIMSFrame(data1)

# Create parameters
parameters <- data_4_model |>
  create_default_configurations() |>
  create_default_parameters(data = data_4_model)

# Run the  model with optimization
base_model <- parameters |>
  initialize_fims(data = data_4_model) |>
  fit_fims(optimize = TRUE)

# Clear memory post-run
clear()
```

## Run likelihood profile  
Once we have a model that is fit, we can run a likelihood analysis to see the impact of each data type on a given parameter. In this example, we will test the impact on R0 but any value can be tested by changing the `parameter_name` argument. The parameter name must match what is 
```{r like_profile}
#| message: false
#| warning: false

like_fit <- run_fims_likelihood(
  model = base_model,
  parameters = parameters,
  parameter_name = "log_rzero", 
  data = data1,
  min = -1,
  max = 1,
  length = 10
)

plot_likelihood(like_fit)

clear()
```